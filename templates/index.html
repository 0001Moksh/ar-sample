<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D/AR Model Viewer</title> <!-- More general title -->

    <!-- Model Viewer Script -->
    <script type="module"
        src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            margin: 0;
        }

        h1, h2 {
             margin-bottom: 1rem;
        }

        .model-container {
            margin-bottom: 40px; /* Add space between models */
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 850px; /* Limit container width */
            margin-left: auto;  /* Center container */
            margin-right: auto; /* Center container */
        }

        model-viewer {
            width: 100%; /* Take full width of container */
            max-width: 800px; /* Still limit viewer size */
            height: 500px; /* Slightly smaller default height */
            margin: 10px auto; /* Center viewer within container */
            border-radius: 8px;
            background-color: #e9ecef;
            display: block;
            position: relative;
        }

        /* Optional: Style the default AR button */
        model-viewer::part(ar-button) {
            background-image: url(https://modelviewer.dev/shared-assets/icons/ic_view_in_ar_new_googblue_48dp.png);
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
            background-color: white;
            position: absolute;
            right: 16px;
            bottom: 16px;
            border-radius: 50%;
            border: none;
            width: 48px;
            height: 48px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Progress bar styling */
        .progress-bar {
            display: block;
            width: 100%;
            height: 4px;
            background-color: #e9ecef;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            border-top-left-radius: 8px; /* Match viewer radius */
            border-top-right-radius: 8px;/* Match viewer radius */
        }
        .update-bar {
            background-color: #007bff;
            width: 0%;
            height: 100%;
            transition: width 0.3s ease;
        }
        model-viewer.loaded .progress-bar {
          visibility: hidden;
        }

        @media (max-width: 767px) {
            model-viewer {
                height: 400px;
            }
            .model-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>Interactive 3D Models with AR Support</h1>

    {# Loop through the models passed from the Flask app #}
    {% for model in models %}
    <div class="model-container">
        <h2>{{ model.name }}</h2> {# Display the model name #}
        <model-viewer
            alt="{{ model.name }}"
            src="{{ url_for('static', filename='model/' + model.filename) }}"
            {# Add AR attributes for better compatibility #}
            ar
            ar-modes="webxr scene-viewer quick-look"
            {# Optional: Add ios-src if you have USDZ files for iOS #}
            {# ios-src="{{ url_for('static', filename='model/' + model.filename.replace('.glb', '.usdz')) }}" #}
            camera-controls
            auto-rotate
            shadow-intensity="1"
            touch-action="pan-y">

            {# Progress bar slot (remains the same for each) #}
            <div class="progress-bar" slot="progress-bar">
                <div class="update-bar"></div>
            </div>

             {# Optional: Explicit AR button if needed, though default usually works #}
             {# <button slot="ar-button" style="background-color: white; border-radius: 4px; border: none; position: absolute; bottom: 16px; right: 16px; ">
                ðŸ‘‹ Activate AR
             </button> #}
        </model-viewer>
    </div>
    {% endfor %}

    {# Optional: Add JS for progress bar updates if needed #}
    <script>
      // This script ensures the progress bar visually updates.
      // ModelViewer itself handles hiding it via the .loaded class in CSS.
      document.querySelectorAll('model-viewer').forEach(viewer => {
        const progressBar = viewer.querySelector('.progress-bar');
        const updateBar = viewer.querySelector('.update-bar');
        viewer.addEventListener('progress', (event) => {
          const progress = event.detail.totalProgress * 100;
          updateBar.style.width = `${progress}%`;
        });
        // Ensure bar is hidden if model loads instantly from cache
        viewer.addEventListener('load', () => {
            // Ensure the loaded class is added for CSS rules
            if (!viewer.classList.contains('loaded')) {
                 viewer.classList.add('loaded');
            }
        });
      });
    </script>

</body>
</html>
